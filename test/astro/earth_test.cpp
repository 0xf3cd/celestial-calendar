#include <gtest/gtest.h>
#include "random.hpp"
#include "julian_day.hpp"
#include "earth.hpp"

namespace astro::earth::heliocentric_coord {

TEST(Earth, vsop87d_evaluate) {
  const std::unordered_map<double, std::tuple<double, double, double>> EXPECTED {
    // JD                   Longitude            Latitude                 Radius
    { 2422823.3699241388, { 232.52621477445064,  0.00023073808290912477,   1.01083930897031 } },
    { 2426430.7587429113, {  188.5945567533272, -0.00020924437518870056, 0.9987765067009008 } },
    { 2426583.6557117873, { 335.81920177266875,    9.75766719235571e-05, 1.0096122786464379 } },
    {  2426871.705031106, { 261.95493069667646,  -3.264191103238397e-05, 1.0157177585457111 } },
    {  2429030.980568436, {  231.0803685525134,   4.503675455975691e-05,  1.010385464114145 } },
    {  2429179.092925863, { 13.653286430730077, -0.00015801384081497722, 0.9991902566748293 } },
    {   2429211.40848769, {  45.83887088224219,   3.077759695977605e-05,  0.990459087734307 } },
    { 2429350.3682991853, { 186.29634545237786,  0.00012785689658667836, 0.9980514986726525 } },
    { 2430024.1373593323, { 129.35787363112104, -0.00010782393570585888, 0.9851308452911599 } },
    { 2430026.4452132587, { 131.70150729575835, -2.9030276957041832e-05, 0.9854405701928337 } },
    {   2432850.71947056, {  32.70731287101444,   -7.78866745132051e-05, 0.9938380365215645 } },
    { 2432863.9657583414, {  45.97386075829854,    0.000255038909336691, 0.9904473579285988 } },
    { 2433369.8886033464, {   188.127963538951,  -9.008108211277949e-05, 0.9985360563313926 } },
    { 2433482.9022044884, { 297.10737339695334,  -9.489356016968527e-05, 1.0161505041334937 } },
    { 2434265.0793738253, {  346.8103191980881, -0.00023310164650140915, 1.0069247428447414 } },
    {  2434510.757828835, { 232.18512287620615, -1.8329151574797984e-05,  1.010618823270194 } },
    { 2434615.0143826823, {  331.9931006209554, -3.2205012862178954e-05,  1.010578070489103 } },
    {  2436078.453793924, {  334.3766631217695,   5.626732587247809e-05,   1.01008273022301 } },
    {  2441564.394671084, {  341.4516987336883,  5.7881294953484587e-05, 1.0084449783933382 } },
    { 2443436.7910593976, { 26.783702079079376,  -0.0001641399042163031, 0.9956342381512754 } },
    {  2445259.818483276, { 23.616091350259012,  -0.0001675166229837329, 0.9965718875198993 } },
    { 2445312.1251873015, {  76.20361077105645, -0.00016389911064636564,  0.984976890178811 } },
    {          2445701.1, { 100.36626193929987, -1.3856637992645944e-05, 0.9832889892830442 } },
    { 2446037.8203384792, {  71.34024053255416,   0.0001710413794825699, 0.9855959016531156 } },
    {  2446419.719571637, {   88.2745378116224,    7.31212053732087e-05, 0.9837931857980308 } },
    {  2446449.279151212, { 118.39302947355372,  2.6196805680453174e-06, 0.9838778419369884 } },
    { 2446582.1626886507, { 249.90452411462775,   8.838093816723094e-05, 1.0139725716004246 } },
    { 2446629.6436457564, {  295.2376787880712,   5.490531028406291e-05, 1.0162818916460785 } },
    { 2447088.8129252703, { 26.377067354133032,  -3.848485738220984e-05, 0.9958363850770097 } },
    { 2447376.2448369158, {  310.6354634866261, -2.4474974499193427e-06, 1.0147122723728654 } },
    { 2447743.8050915487, {   312.856214739189,  0.00014357904474562554,  1.014398275454397 } },
    {          2451545.0, { 100.37784367119836, -0.00022721051444223787, 0.9833276819105508 } },
    {   2454108.39964838, { 107.20829966978181, -1.3171353215111324e-05, 0.9833130630882807 } },
    {          2454359.1, {  352.3761960836978,  0.00010725756446863268, 1.0057018016353796 } },
    {      2454774.36215, {   41.8062247735661,  0.00010196625102869854,  0.991769848723092 } },
    { 2456134.2019950035, { 303.13799353599825,  0.00018587799231099608, 1.0156698649268965 } },
    { 2457379.3820498018, {  90.69985449354044,  0.00015546023879402102, 0.9836538399101521 } },
    { 2458286.8923123176, {  266.1619762197288,  1.6303499668404617e-05, 1.0159532042352142 } },
    { 2458611.2938420703, { 226.94740574652496,   8.716366947624349e-05, 1.0090995443264372 } },
    {         2460505.25, { 291.82761866574583,   3.226703118214394e-05, 1.0165107642588653 } },
    {  2461026.069726484, {  84.85390305662804,  0.00011486371524798457, 0.9841952402940332 } },
    { 2461825.2818038324, { 154.67670852829724,  -2.739358080141719e-05, 0.9894161823070876 } },
    {      2462597.96105, {  196.6987939374485, -3.1791715908057304e-05, 1.0006923288119707 } },
    {          2464080.5, {   217.801271862083,  0.00012100241309577134, 1.0065840587631982 } },
    { 2466686.3166366946, { 265.07654237364477,   0.0002457615452398633, 1.0157557939729247 } },
    {   2467452.53831438, { 299.17088627562225,  0.00024041389391947702, 1.0160599221412034 } },
    { 2467736.2445348585, { 221.03385698570128, -0.00019162480143494935, 1.0074967262304044 } },
    { 2467862.5776862516, { 342.19985070983785,   0.0001564318545287504,  1.008489932046558 } },
    { 2467992.0963500296, { 111.76489133972245,   0.0001586307815848196, 0.9834631693601811 } },
    { 2469167.3740318674, { 191.81865539685168,  0.00014269064770430065, 0.9991354508617272 } },
    {  2469328.649713379, {  347.1496341326092,  0.00014054212392372367, 1.0072932259323806 } },
    {  2469870.136664962, { 164.23818508069962,  0.00016777204174928757, 0.9915443381557025 } },
    { 2470250.4107887936, { 179.25112101137347,  0.00016465060552632626, 0.9955271996278494 } },
    { 2474418.7515966985, {  324.6622403800611,  0.00014023112157109802, 1.0124998572642698 } },
    {  2475746.108976349, { 196.13496352249422,  0.00013502586576091797, 1.0003076592752869 } },
    { 2480354.4493282423, {  54.98284147960294,  0.00013776510729457625, 0.9889332227624097 } },
    { 2481044.4651485193, {  14.61788166664337, -0.00015708944594153683, 0.9996489874066633 } },
  };

  for (const auto& [jd, expected] : EXPECTED) {
    const auto& [λ, β, r] = vsop87d(jd);
    ASSERT_NEAR(λ.as<DEG>(), std::get<0>(expected), 1e-11);
    ASSERT_NEAR(β.as<DEG>(), std::get<1>(expected), 1e-16);
    ASSERT_NEAR(r,           std::get<2>(expected), 1e-14);
  }
}

}
