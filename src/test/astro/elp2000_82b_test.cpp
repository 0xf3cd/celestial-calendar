#include <gtest/gtest.h>
#include "julian_day.hpp"
#include "elp2000_82b.hpp"

namespace astro::elp2000_82b::test {

using namespace astro::elp2000_82b::coeff;
using namespace astro::elp2000_82b;

TEST(Elp2000, Evaluate) {
  const std::unordered_map<double, std::tuple<double, double, double>> dataset {
    //JDE                   L expected            B expected          R expected
    { 2454604.8408631925, {   2.582289817128636,  -4.842418658136719,  19690.946193627213 } },
    { 2458685.7070086063, { -1.4783764079777792,  -4.477067319633124,   20457.09768861256 } },
    { 2458332.7850387506, { -6.5453778792687425,  -4.778781133597288,   8877.876351376079 } },
    {  2454811.831285011, { -3.1500666848899703,   4.815623137356183, -25959.147131076956 } },
    {  2452060.308913401, {   2.840267796055537,   5.037880960926955,  -12896.50430243581 } },
    {  2455227.041249955, {  0.1378119794322005, -2.0967153419884452, -28379.609525648775 } },
    { 2456964.3634396503, {   0.756504669176526,    2.82419226306086,  -17108.18764224571 } },
    {   2457264.83632988, { -0.5684510915986543,  1.4956261880687236, -26624.668804786892 } },
    {  2456515.255481393, {  -5.717573609791293,  -3.144884704634817,   4002.873662424347 } },
    { 2459325.9895011173, {  -7.874820303878704,   4.680424961370601,  -587.3539723540979 } },
    { 2455375.0883495286, {  3.3783761028881982,  0.6013712923689936,   13543.55646987846 } },
    {  2461067.911397351, {  -2.584040575663781,  5.0047441084846165, -16121.432251918439 } },
    {  2461482.759775764, { -0.6627234124774705,  1.6591264769763334, -18125.684706028343 } },
    {  2460471.616416856, {   4.905566153497155,   4.734958981038485,   7682.147742690851 } },
    {  2452431.764878056, { -1.5942876152822898,  -4.419851133094991,    17757.9901184226 } },
    { 2460750.6229077843, {   0.641224267685788,   -1.68420010378939,  19741.982602294927 } },
    { 2451672.4985669567, {  1.8867247050554679, -1.4750193038978274, -20114.706332054404 } },
    { 2460765.6820785394, {  1.4103378205491814,  3.2321111451456166, -26021.484642677544 } },
    { 2458845.7444276633, {   4.445605115257049, -1.9762548842815648,   7477.538354798985 } },
    {  2453510.669719863, {  -6.231717291399883,  0.8857067990541531,  1678.1562468758784 } },
    { 2461428.8290962316, {  3.0076122603331243,   0.550866795352839, -25738.525928943527 } },
    {   2459252.31357605, {  2.3673609957866235, 0.25632480617837244,    -12785.373048343 } },
    { 2454887.1428307826, {   -4.46251068602726,   1.966297765843496,    9741.44227664446 } },
    {  2451908.510892492, { -3.1134910062544945, -3.3762835555239383,  20336.562469225537 } },
    {  2452990.698877131, {  -6.864655850336655,  3.9574021031455526,  -7327.391459564207 } },
    {  2454530.464473637, {  -5.884634788350537,  -1.599194314110703,  60.332028105473036 } },
    { 2457064.2416281467, {  -6.609087776283496,   2.128940929061539,  12085.336654376686 } },
    { 2461117.6701599816, {  -5.452936916448812,  0.6576151666181321, -8014.7005277712515 } },
    {  2457993.610749476, {    3.62605946554336,   5.267804934677309,  15751.995440570176 } },
    { 2460403.7955414844, {  -6.517915712244787,  -5.158168789287733, -11879.115546577277 } },
    { 2453676.6621931484, {  -4.872181968139235,  -2.419981486598571,   50.30866511259016 } },
    {  2459558.850283874, {    7.81958534490319,  -5.225565842407398,  -2675.227796275508 } },
    {   2461419.81325624, {  -7.363993973204995,   3.693206067560148,   5307.834449207222 } },
    { 2454745.4649419296, { -1.2164122027711346,  -3.862490283498746,  19547.482459452338 } },
    { 2457182.2521343804, { -1.2453860027067365,  2.6500037415813926, -14750.438359793494 } },
    {   2452488.36574131, {  -4.266163120526344,    -2.7340810760339,  14963.726424825158 } },
    {  2452816.112815386, {  0.4067588115214825, -1.0646097166130095,  20093.666227948674 } },
    { 2452984.8373878123, {  -4.204546593273821,   4.317158817393487,   16733.51193734921 } },
    { 2456715.4114495614, { -1.3916671785944452,   5.086190363508444,  -23874.37431854325 } },
    { 2453831.2602669974, {   5.763781119062065,   5.121856563285299,  12564.426715616308 } },
    { 2455691.0876661497, {  -6.302411052376583,  -3.250316130118522,  -5607.428429960403 } },
    {  2451936.054791727, {  -2.665000280065082, -3.5801100972793045,  20550.409503408104 } },
    { 2460491.7970592957, {  2.2801819671383425,   1.362255153038053, -13566.184872913267 } },
    { 2460908.5345860063, {  4.9047677612035105,  3.8732782162629857,  -5735.422799241947 } },
    { 2452216.1584471553, {  -4.697142254638545,   -2.63716415490697,  3053.8469175542614 } },
    { 2456065.0139947063, {   3.446386212861611,  3.7968994449509603,   19659.76316980017 } },
    { 2461525.6659828695, { -3.5086256650591863,  0.6378864193945036,   15881.87736085146 } },
    { 2458954.4433182925, {    7.19794431823625,  -2.040769980240513,   5308.702452736388 } },
    { 2456583.7698594616, {  5.1721312805325095,  1.9275160165717289, -1981.6203479574826 } },
    { 2453807.0676169395, {  1.4571038286113007,   3.302915032409387,   21181.34425776164 } },
    {  2453067.012398426, { -3.7917068207758633,   4.635135371850714,   13529.44614315694 } },
    {  2454093.513893386, {   -3.29012169792004, -2.8214569003159204, -10780.078601063029 } },
    { 2461514.2037960556, {  3.7898626796808172, -3.3947342449437974,  -9044.809334341979 } },
    { 2451563.0617605243, { -0.3930578502771989,   -2.47004868878678, -25504.752978681263 } },
    { 2457634.2626562244, {  3.7443503936531677,  1.2727360971922423,  12558.447865432185 } },
  };

  for (const auto& [jde, expected] : dataset) {
    const auto& [Σl, Σb, Σr] = expected;
    const auto jc = julian_day::jde_to_jc(jde);

    const auto evaluated = evaluate(jc);
    ASSERT_NEAR(evaluated.Σl, Σl, 1e-10);
    ASSERT_NEAR(evaluated.Σb, Σb, 1e-11);
    ASSERT_NEAR(evaluated.Σr, Σr, 2e-7);
  }
}


} // namespace astro::elp2000_82b::test