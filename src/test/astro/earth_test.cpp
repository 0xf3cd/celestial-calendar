#include <gtest/gtest.h>
#include "random.hpp"
#include "julian_day.hpp"
#include "earth.hpp"

namespace astro::earth::test {

using namespace astro::earth;

TEST(Earth, Vsop87dEvaluate) {
  using namespace heliocentric_coord;

  const std::unordered_map<double, std::tuple<double, double, double>> dataset {
    // JDE                   Longitude            Latitude                 Radius
    { 2422823.3699241388, { 232.52621477445064,  0.00023073808290912477,   1.01083930897031 } },
    { 2426430.7587429113, {  188.5945567533272, -0.00020924437518870056, 0.9987765067009008 } },
    { 2426583.6557117873, { 335.81920177266875,    9.75766719235571e-05, 1.0096122786464379 } },
    {  2426871.705031106, { 261.95493069667646,  -3.264191103238397e-05, 1.0157177585457111 } },
    {  2429030.980568436, {  231.0803685525134,   4.503675455975691e-05,  1.010385464114145 } },
    {  2429179.092925863, { 13.653286430730077, -0.00015801384081497722, 0.9991902566748293 } },
    {   2429211.40848769, {  45.83887088224219,   3.077759695977605e-05,  0.990459087734307 } },
    { 2429350.3682991853, { 186.29634545237786,  0.00012785689658667836, 0.9980514986726525 } },
    { 2430024.1373593323, { 129.35787363112104, -0.00010782393570585888, 0.9851308452911599 } },
    { 2430026.4452132587, { 131.70150729575835, -2.9030276957041832e-05, 0.9854405701928337 } },
    {   2432850.71947056, {  32.70731287101444,   -7.78866745132051e-05, 0.9938380365215645 } },
    { 2432863.9657583414, {  45.97386075829854,    0.000255038909336691, 0.9904473579285988 } },
    { 2433369.8886033464, {   188.127963538951,  -9.008108211277949e-05, 0.9985360563313926 } },
    { 2433482.9022044884, { 297.10737339695334,  -9.489356016968527e-05, 1.0161505041334937 } },
    { 2434265.0793738253, {  346.8103191980881, -0.00023310164650140915, 1.0069247428447414 } },
    {  2434510.757828835, { 232.18512287620615, -1.8329151574797984e-05,  1.010618823270194 } },
    { 2434615.0143826823, {  331.9931006209554, -3.2205012862178954e-05,  1.010578070489103 } },
    {  2436078.453793924, {  334.3766631217695,   5.626732587247809e-05,   1.01008273022301 } },
    {  2441564.394671084, {  341.4516987336883,  5.7881294953484587e-05, 1.0084449783933382 } },
    { 2443436.7910593976, { 26.783702079079376,  -0.0001641399042163031, 0.9956342381512754 } },
    {  2445259.818483276, { 23.616091350259012,  -0.0001675166229837329, 0.9965718875198993 } },
    { 2445312.1251873015, {  76.20361077105645, -0.00016389911064636564,  0.984976890178811 } },
    {          2445701.1, { 100.36626193929987, -1.3856637992645944e-05, 0.9832889892830442 } },
    { 2446037.8203384792, {  71.34024053255416,   0.0001710413794825699, 0.9855959016531156 } },
    {  2446419.719571637, {   88.2745378116224,    7.31212053732087e-05, 0.9837931857980308 } },
    {  2446449.279151212, { 118.39302947355372,  2.6196805680453174e-06, 0.9838778419369884 } },
    { 2446582.1626886507, { 249.90452411462775,   8.838093816723094e-05, 1.0139725716004246 } },
    { 2446629.6436457564, {  295.2376787880712,   5.490531028406291e-05, 1.0162818916460785 } },
    { 2447088.8129252703, { 26.377067354133032,  -3.848485738220984e-05, 0.9958363850770097 } },
    { 2447376.2448369158, {  310.6354634866261, -2.4474974499193427e-06, 1.0147122723728654 } },
    { 2447743.8050915487, {   312.856214739189,  0.00014357904474562554,  1.014398275454397 } },
    {          2451545.0, { 100.37784367119836, -0.00022721051444223787, 0.9833276819105508 } },
    {   2454108.39964838, { 107.20829966978181, -1.3171353215111324e-05, 0.9833130630882807 } },
    {          2454359.1, {  352.3761960836978,  0.00010725756446863268, 1.0057018016353796 } },
    {      2454774.36215, {   41.8062247735661,  0.00010196625102869854,  0.991769848723092 } },
    { 2456134.2019950035, { 303.13799353599825,  0.00018587799231099608, 1.0156698649268965 } },
    { 2457379.3820498018, {  90.69985449354044,  0.00015546023879402102, 0.9836538399101521 } },
    { 2458286.8923123176, {  266.1619762197288,  1.6303499668404617e-05, 1.0159532042352142 } },
    { 2458611.2938420703, { 226.94740574652496,   8.716366947624349e-05, 1.0090995443264372 } },
    {         2460505.25, { 291.82761866574583,   3.226703118214394e-05, 1.0165107642588653 } },
    {  2461026.069726484, {  84.85390305662804,  0.00011486371524798457, 0.9841952402940332 } },
    { 2461825.2818038324, { 154.67670852829724,  -2.739358080141719e-05, 0.9894161823070876 } },
    {      2462597.96105, {  196.6987939374485, -3.1791715908057304e-05, 1.0006923288119707 } },
    {          2464080.5, {   217.801271862083,  0.00012100241309577134, 1.0065840587631982 } },
    { 2466686.3166366946, { 265.07654237364477,   0.0002457615452398633, 1.0157557939729247 } },
    {   2467452.53831438, { 299.17088627562225,  0.00024041389391947702, 1.0160599221412034 } },
    { 2467736.2445348585, { 221.03385698570128, -0.00019162480143494935, 1.0074967262304044 } },
    { 2467862.5776862516, { 342.19985070983785,   0.0001564318545287504,  1.008489932046558 } },
    { 2467992.0963500296, { 111.76489133972245,   0.0001586307815848196, 0.9834631693601811 } },
    { 2469167.3740318674, { 191.81865539685168,  0.00014269064770430065, 0.9991354508617272 } },
    {  2469328.649713379, {  347.1496341326092,  0.00014054212392372367, 1.0072932259323806 } },
    {  2469870.136664962, { 164.23818508069962,  0.00016777204174928757, 0.9915443381557025 } },
    { 2470250.4107887936, { 179.25112101137347,  0.00016465060552632626, 0.9955271996278494 } },
    { 2474418.7515966985, {  324.6622403800611,  0.00014023112157109802, 1.0124998572642698 } },
    {  2475746.108976349, { 196.13496352249422,  0.00013502586576091797, 1.0003076592752869 } },
    { 2480354.4493282423, {  54.98284147960294,  0.00013776510729457625, 0.9889332227624097 } },
    { 2481044.4651485193, {  14.61788166664337, -0.00015708944594153683, 0.9996489874066633 } },
  };

  for (const auto& [jde, expected] : dataset) {
    const auto& [λ, β, r] = vsop87d(jde);
    ASSERT_NEAR(λ.deg(), std::get<0>(expected), 1e-11);
    ASSERT_NEAR(β.deg(), std::get<1>(expected), 1e-16);
    ASSERT_NEAR(r.au(),  std::get<2>(expected), 1e-14);
  }
}

TEST(Earth, NutationMeeus) {
  using namespace nutation;

  const std::unordered_map<double, std::tuple<double, double>> dataset {
    // JDE                   Longtitude nutation       Obliquity nutation
    {  2422340.375810433, {   0.0040657677880880485,  -0.0017067131109079594 } },
    { 2422398.7534509795, {   0.0037793130689208494,  -0.0015459936176003297 } },
    { 2422889.0369291026, {   0.0021646509176421543,  -0.0025007270491914885 } },
    { 2423044.3386338702, {   0.0012078807942815738,  -0.0026419914484857895 } },
    { 2424143.5479488997, {   -0.003413047661418337,  -0.0020168648250004483 } },
    {  2425700.907808951, {   -0.003908630312746152,   0.0016586584343333197 } },
    { 2425790.7467539664, {  -0.0034379702091010527,   0.0015553997635223127 } },
    { 2426384.0879184753, {  -0.0010263406462362947,    0.002431530195415759 } },
    { 2426795.6037728363, {    0.000340802127700449,    0.002642896066685235 } },
    {  2427208.803229057, {   0.0018551917445575633,   0.0022339395866292837 } },
    { 2427450.7564669345, {   0.0031894381851315158,   0.0018317886567032367 } },
    {  2428509.842707913, {    0.004562941065751866, -0.00032078738468853336 } },
    { 2428543.9081679783, {   0.0049836639980453375,  -0.0004358473489478132 } },
    {  2429959.841122248, {   0.0003187491524165358,  -0.0026390046456272118 } },
    {  2431012.691798894, {   -0.003919431164140824,  -0.0015911135763803526 } },
    {  2432108.882401349, {   -0.004882364814460669,   0.0008013518322536484 } },
    {  2432382.426173181, {   -0.003872054211253279,    0.001159029511383572 } },
    {  2433004.757790271, {   -0.002177000284843999,    0.002448203755774961 } },
    { 2433825.8635399938, {   0.0013757866972070288,   0.0022899939899218252 } },
    { 2434708.7876060125, {    0.003996063874983029,    0.001067953266941842 } },
    {  2435946.231479802, {    0.003499228275812199,   -0.001528634735963021 } },
    { 2436783.7840488805, {   0.0009389794679040993,   -0.002602680104649735 } },
    {  2436844.609421583, {   9.386500960483583e-05,   -0.002405183582453856 } },
    {  2438087.255070865, {  -0.0040013203266253735,  -0.0010320911002189514 } },
    {  2438256.743860282, {   -0.004234460423226958,  -0.0007879373600771477 } },
    {   2438900.77492155, {   -0.004829383559908987,   0.0006023326743599408 } },
    {  2439066.207857216, {   -0.004649942477119271,    0.001087311961534499 } },
    {  2439291.515944128, {  -0.0039541725302472686,   0.0013715934783601583 } },
    {  2440207.004359327, {  -0.0006192475224473928,    0.002370841180251019 } },
    { 2442237.6108382284, {    0.004904456900944497,  -0.0006248861135872098 } },
    {   2442967.22676948, {   0.0032146321677397316,  -0.0021320376078835437 } },
    {  2445475.396173701, {  -0.0049951751739948135,  0.00013001458706899877 } },
    { 2445696.9748221664, {   -0.004535124938552673,   0.0005618848269447878 } },
    { 2446302.4356824094, {   -0.002920800092289066,   0.0019335517484959297 } },
    { 2447011.5724826814, { -0.00017490788529651364,   0.0024856763556318114 } },
    {  2448363.628814646, {    0.004021581291623651,    0.001115386279193534 } },
    {  2448615.955147306, {    0.004788328172614378,  0.00033045202137838464 } },
    {  2448949.676100405, {    0.004358488009105798, -0.00040344112031306137 } },
    { 2449116.1222834974, {    0.004295162485018655,  -0.0007403902120874351 } },
    { 2449214.6077099093, {    0.004831915656303715,  -0.0008999857891986098 } },
    { 2449313.9874912035, {    0.003992998774517171,  -0.0011974980656458253 } },
    { 2449863.2107339934, {    0.002437884485271847,  -0.0022109960452591044 } },
    { 2451548.7729886686, {   -0.003802546741362358,  -0.0016165976378760684 } },
    {  2451935.375714305, {   -0.004231162211835557,  -0.0006612399977948967 } },
    {  2452516.784166539, {   -0.004408800398236335,   0.0008429532306986307 } },
    { 2452611.9925973807, {   -0.004713631008236194,   0.0008145238710898548 } },
    { 2453626.8855490894, {  -0.0010939848063609794,    0.002567242781790643 } },
    { 2454878.7989377705, {    0.004002359319647755,    0.001655150176308519 } },
    { 2455842.7612202917, {    0.004528522258325705, -0.00037564129895429086 } },
    { 2455997.9427857166, {    0.004598919643703359,  -0.0007271603049803447 } },
    { 2456996.2534103473, {   0.0011041295201296578,  -0.0026135153708072797 } },
    { 2457314.5808233395, {  -0.0003802251531895207,  -0.0024999667102682858 } },
    {  2457793.634625955, {  -0.0016852729072273308,   -0.002300643239666625 } },
    {  2457986.876916977, {  -0.0025046989213735917,    -0.00199734174107822 } },
    { 2458449.0178416697, {   -0.004499524603588191,  -0.0013709019494258365 } },
    {  2458997.208334942, {   -0.004971905292726775, -0.00011965089040662851 } },
    { 2460044.4292269014, {   -0.002950484238421225,    0.002187974419863369 } },
    { 2460740.4865812617, {   0.0003291911313435054,   0.0026460961123110525 } },
    {  2461436.118134327, {   0.0032773189707089763,    0.001951004600463474 } },
    {  2462666.487516558, {    0.004526528812138123,  -0.0007613334815925312 } },
    {  2463097.324365982, {    0.004227035552422422,   -0.001447052410393183 } },
    { 2463333.9721958265, {    0.002924819180327766,  -0.0018227297039249129 } },
    { 2463993.7288231244, {    0.000903377166579852,  -0.0026102618371222947 } },
    {  2464229.848762739, {  -0.0005968209626123586,   -0.002405128999460906 } },
    {  2465999.811117985, {    -0.00442580436909384,   0.0004336690736762839 } },
    {  2466203.186214432, {   -0.004111393016545394,   0.0010285684032050445 } },
    {   2467082.25164015, {  -0.0014549193394428502,   0.0022169454394126483 } },
    {  2467294.240015165, {  -0.0005632211253229838,    0.002570664571176113 } },
    { 2468138.8957093535, {    0.002473441543270918,    0.002004936369725639 } },
    {  2470325.743427222, {    0.002278543156666961,   -0.002318815173464606 } },
    {   2470880.41708627, { -2.1357076374719522e-05,   -0.002746269023360518 } },
    {  2471828.173646928, {   -0.003404364328124849,  -0.0017627257787989556 } },
    { 2472648.6162451827, {   -0.005046879129287146,   0.0002865292722299431 } },
    {  2473200.139704932, {   -0.004276366474396372,   0.0014222272490721766 } },
    { 2473917.9081599973, {   -0.001724773898850154,    0.002549255854591494 } },
    { 2475397.9232281083, {   0.0036566697915806933,   0.0014132839397637143 } },
    { 2476204.0362541215, {   0.0048695196399296875,  -0.0006099248166509994 } },
    {  2478017.067779735, {  -0.0013646254305936946,   -0.002603573079261844 } },
    {   2478100.66054527, {  -0.0017535918467418475,   -0.002232394604702223 } },
    { 2480872.0077970326, {   -0.001251478539786107,    0.002596233006697205 } },
    {   2422090.09896842, {    0.004015369445259096,  -0.0010779641240313735 } },
    {  2422207.160542752, {   0.0043276950913943195,  -0.0012077347609423274 } },
    {  2422517.575263606, {   0.0034142961058572572,   -0.002035964603622872 } },
    {  2424405.506879227, {  -0.0039737450877261535,  -0.0012241429092135216 } },
    {  2424810.950873093, {   -0.005113274235644308,  -0.0003574426898990372 } },
    {  2425231.756347664, {    -0.00473003336416087,   0.0004048205856927597 } },
    { 2426238.7677604365, {  -0.0019018329160769827,    0.002445551828633918 } },
    { 2426499.1217175648, {  -0.0010016106489310684,    0.002358709464550671 } },
    { 2426675.4167228946, { -0.00040288909015472773,   0.0024045485043739426 } },
    {  2430098.394368629, { -0.00021687996615633913,  -0.0024758911836387813 } },
    { 2430461.2530489224, {  -0.0017008083279358725,  -0.0023119712205860498 } },
    { 2431225.3970295154, {  -0.0044016014465310446,   -0.001359855283523394 } },
    {  2431743.114017723, {   -0.005046710818556482,  -4.406099248398192e-05 } },
    { 2432051.0587178436, {   -0.004396154337615209,   0.0006523234483003709 } },
    {   2432763.67289865, {    -0.00274944346335807,   0.0019113445671888394 } },
    { 2433030.9329518294, {   -0.002269508966189707,   0.0023796818421616813 } },
    {   2433271.04517987, {  -0.0010186851841677332,   0.0022779595603115987 } },
    { 2434010.8223002446, {   0.0022622801760509063,   0.0021076369246361038 } },
    { 2434277.0044656973, {    0.002954019834841424,    0.002113257260903732 } },
    {   2436534.17996145, {   0.0013022514430963484,  -0.0025375469816894137 } },
    {   2436808.63540103, {   0.0006974929126062126,  -0.0024905490617337348 } },
    {  2439346.888835815, {   -0.003413329580303698,   0.0016248121829426927 } },
    {  2439775.474823454, {   -0.002380836631951028,   0.0023509548013150084 } },
    {  2440341.419373917, {  -0.0002306770251539386,    0.002593668503620056 } },
    { 2441165.6409456544, {   0.0036104169284158403,   0.0017385495024997471 } },
    {  2441345.540317213, {    0.004299474348306365,   0.0014197646023063558 } },
    { 2441755.1346226097, {    0.004806057096362321,   0.0007487817818342673 } },
    {   2442632.32374391, {    0.004453145864028442,  -0.0013756515446313943 } },
    { 2443734.3774254355, {  0.00018185140796238508,  -0.0025700358080294624 } },
    { 2444976.6747426963, {   -0.004287579895916404,  -0.0011293472540642457 } },
    {  2445770.813435082, {    -0.00436265307766267,   0.0009811327847180865 } },
    { 2446106.0048078806, {   -0.003397952940489344,   0.0016078678853384007 } },
    { 2446669.3899216987, {  -0.0016394873765535538,    0.002414892463191699 } },
    { 2447276.0178410998, {   0.0005003927074004352,    0.002554094913613855 } },
    {  2448247.087771536, {    0.004128143335099947,   0.0011285033582241076 } },
    { 2449221.5866807043, {     0.00471498714225378,  -0.0008536457559196529 } },
    { 2449971.3138534273, {   0.0024288823552469974,  -0.0020979209708122566 } },
    {  2450406.743337764, {  0.00012131593314523675,    -0.00261873233348037 } },
    { 2450438.6407655375, {     0.00025885752336072,   -0.002740381644556887 } },
    { 2452653.0406790823, {   -0.004131747622951573,   0.0009238864580646451 } },
    {  2452820.877680251, {  -0.0038549938336539377,   0.0012060409701636198 } },
    {  2454431.251998727, {   0.0019001354518392395,    0.002114357110757388 } },
    { 2454830.6695150686, {   0.0037069906521617897,    0.001528149763745316 } },
    {  2455089.273119053, {   0.0043185342492385904,   0.0013258913628338676 } },
    {  2455310.879738816, {    0.004315668004576813,   0.0007969586569833177 } },
    { 2456352.4369620373, {     0.00395920214215796,   -0.001479922875941127 } },
    {  2457537.500470369, {  -0.0012416337298529385,   -0.002623606953376793 } },
    { 2457783.1761083547, {     -0.0016606466468536,  -0.0023465348606299752 } },
    {  2458625.526520871, {    -0.00478604820648423,  -0.0009664482472519316 } },
    { 2458918.5562338727, {   -0.004588235547978744,   -1.92560267169779e-07 } },
    {  2459567.129796575, {  -0.0041741416009835955,   0.0010970300404111333 } },
    {  2460530.256975736, {  -0.0003945834073592218,     0.00253192141815293 } },
    {  2461557.001589851, {   0.0030500670506308798,   0.0017118479072036916 } },
    { 2461985.9276092304, {     0.00476317201092416,   0.0009275093832608901 } },
    {  2462970.533179503, {    0.004008048999224269,  -0.0011745546392334261 } },
    {   2463012.60211737, {    0.003876024522020796,  -0.0014593871134653516 } },
    { 2464276.3635937837, {  -0.0012222527860376016,  -0.0025554580120257867 } },
    {  2465321.693990451, {   -0.004305258686253801,   -0.000933302016918894 } },
    {  2466111.828951268, {    -0.00489873393212414,   0.0006416708477019335 } },
    {  2466632.991334447, {  -0.0036282101928172866,   0.0018142943930922694 } },
    {  2468133.776518314, {    0.002422505617355662,    0.001971031369637341 } },
    { 2468958.9657683754, {    0.004815987028035347,   0.0007500500413038599 } },
    { 2468967.6804104405, {   0.0047280557991700375,   0.0007025258015341774 } },
    { 2469083.9192209886, {    0.004900172606564714,  0.00019723917877258545 } },
    { 2469288.8799633486, {    0.005073159447936992, -0.00020258551751011058 } },
    {  2469574.257353161, {    0.004198799556130704,  -0.0008530922688953438 } },
    { 2470731.8964322703, {   0.0010482983737570698,   -0.002668429074733074 } },
    {  2472120.636174116, {   -0.004715422425746154,  -0.0010915710152450582 } },
    {  2472392.920789782, {   -0.004397487257005382,  -0.0005008698668142218 } },
    {  2472602.227276084, {   -0.004493760736945568,  0.00010334611912213967 } },
    { 2473320.4094925025, {  -0.0034700166210657325,   0.0016332110379049891 } },
    { 2473720.2969324784, {   -0.002355481184067813,   0.0023062968258872013 } },
    {  2475176.172496177, {    0.003438509871545706,    0.001943642609547977 } },
    {  2475341.751832905, {    0.004097752126473449,   0.0015895027429618164 } },
    { 2476862.0088341716, {    0.003125135070948825,   -0.001799065441733381 } },
    { 2477253.0167555586, {   0.0016524760031169292,   -0.002426769565121958 } },
    { 2477688.2433182304, {   0.0004166701587676462,   -0.002598891377358864 } },
    { 2478321.2490358176, {  -0.0029931623531688645,   -0.002104442176303156 } },
    {  2479227.658191356, {   -0.005004124518923995,  -0.0002979985808843457 } },
    {  2480451.250390129, {    -0.00237376690796081,   0.0022060963840429253 } },
  };

  for (const auto& [jde, expected] : dataset) {
    const auto& [lon_nut, obl_nut] = expected;

    ASSERT_NEAR(longitude(jde, Model::MEEUS).as<DEG>(), lon_nut, 1e-14);

    const double obl_epsilon = std::invoke([] {
      // On i386 platform, the epsilon is 4e-15, otherwise it is 1e-15.
      #if defined(__i386__) || defined(_M_IX86)
        return 4e-15;
      #else
        return 1e-15;
      #endif
    });

    ASSERT_NEAR(obliquity(jde, Model::MEEUS).as<DEG>(), obl_nut, obl_epsilon);
  }
}

TEST(Earth, NutationIau1980) {
  using namespace nutation;

  // The following data was collected from running https://www.iausofa.org/2021_0512_C/sofa/nut80.c.
  const std::unordered_map<double, std::pair<double, double>> dataset = {
    // JDE                   Δlongitude [rad]         Δobliquity [rad]
    { 2421984.2444770792, {   8.446894530911212e-05,  -1.580994865478172e-05 } },
    {  2422690.599729854, {    4.85201381018781e-05,  -3.993750969621093e-05 } },
    { 2422705.8259552885, {   4.965114798514485e-05,   -3.94185641930276e-05 } },
    { 2425166.5491615357, {  -8.797223545574204e-05,   8.935336113868527e-06 } },
    { 2425236.4044939936, {  -8.254009313927864e-05,   6.486757407673869e-06 } },
    {  2425876.393090533, {  -5.903840350581697e-05,  3.4915201676827894e-05 } },
    { 2427928.3184033316, {   6.873180005370006e-05,  1.9126757622734415e-05 } },
    {  2428257.751604889, {   8.206323664095849e-05,   9.001821480762277e-06 } },
    {  2430213.745756218, {  -9.120590843003123e-07, -4.4933255060147073e-05 } },
    {  2430776.440960561, {  -4.240556351608917e-05,  -3.481223322314296e-05 } },
    { 2430798.3800260755, {  -4.799054591167969e-05,  -3.366382240508418e-05 } },
    { 2433072.9656811594, { -3.5125374427508475e-05,   3.895047286980187e-05 } },
    { 2434675.8531967304, {   6.583542441040638e-05,  2.2167498049349426e-05 } },
    {  2435916.371139847, {   6.778574265899644e-05, -2.4092760536093076e-05 } },
    { 2436100.5981531804, {   5.847225268826385e-05, -3.0203671419407447e-05 } },
    {   2437084.72669671, {  -1.705161645092414e-05,  -4.669419828536043e-05 } },
    {  2437236.510075185, {  -3.107611762113804e-05,  -4.193685229689089e-05 } },
    { 2437548.0630772426, {  -4.354977435759828e-05, -3.5209925754319816e-05 } },
    { 2438394.2258140217, {  -7.973174754658102e-05, -1.1637647184251066e-05 } },
    {  2440488.005224642, {  1.3900282984760115e-05,  4.6631218662955616e-05 } },
    { 2440955.3887702557, {   4.844765263067498e-05,  3.4746432835125023e-05 } },
    {  2441003.568387912, {   5.467253222477824e-05,    3.66050443756725e-05 } },
    { 2441165.9551653117, {    6.31817270545114e-05,  3.0324552259153535e-05 } },
    { 2441846.4374457067, {   7.967738093984167e-05,   4.305730394907702e-06 } },
    {  2445619.444864444, {  -8.595598013344222e-05,   1.084171590555874e-05 } },
    { 2446671.6054946464, { -2.8118726871120057e-05,   4.202039112949784e-05 } },
    { 2447462.0228674593, {  1.8974086544988215e-05,   4.248898304169863e-05 } },
    {    2448035.9300329, {   5.641022415414741e-05,   2.727120745254823e-05 } },
    {  2448623.438269629, {   8.376084489376253e-05,   4.918076018492774e-06 } },
    {  2449255.189863216, {   7.725557675749695e-05, -1.5119421927479871e-05 } },
    {  2449364.451571674, {   7.905331570859905e-05, -2.4113934265463547e-05 } },
    {  2451121.105321128, { -5.3777137492059964e-05,  -3.721444016168132e-05 } },
    { 2453053.1202489366, {   -5.09030604682791e-05,  3.2262786882959715e-05 } },
    {  2453629.637602212, { -1.8579109509501676e-05,   4.565279303168538e-05 } },
    {  2455025.602575583, {   7.447475130873722e-05,  2.1482356259923606e-05 } },
    {  2456556.469234909, {  5.3564052581802984e-05, -3.1359533310600145e-05 } },
    {  2456904.223166271, {    3.39554245316814e-05,  -4.009639891281149e-05 } },
    {    2457508.3435319, { -2.1065425054551715e-05, -4.3854325039141257e-05 } },
    {  2457624.466158467, { -2.0902513204078464e-05, -4.1519391729769546e-05 } },
    {  2457920.385615982, {  -4.622552368653274e-05,    -4.0320059713744e-05 } },
    { 2458102.3812665325, {  -5.942426280132199e-05,  -3.579942286394665e-05 } },
    {  2458798.357524769, {  -9.020507211876718e-05,  -8.124950118647258e-06 } },
    { 2459200.2184332996, {  -8.189214704518406e-05,   5.193099427273399e-06 } },
    {  2459490.523510772, {  -7.655597581207047e-05,   2.229104053983186e-05 } },
    {  2460426.763367466, { -2.7406346737746176e-05,  4.3251625989101704e-05 } },
    { 2460771.4257826083, {  3.8086509632159965e-06,   4.606444599701634e-05 } },
    {  2461333.113344497, {  3.9965595271953435e-05,   3.873900775833085e-05 } },
    {  2461370.731910192, {   4.160768098439236e-05,    3.39705326881111e-05 } },
    {  2463677.551640765, {   3.229871843763151e-05,  -3.881278503838365e-05 } },
    { 2464145.0651733615, { -1.0164077520209207e-06,  -4.798465890131621e-05 } },
    { 2464212.8635295196, { -5.6116753183917845e-06,  -4.278301186317767e-05 } },
    {  2464805.523922991, {  -5.596736430348037e-05,  -3.423809503426634e-05 } },
    { 2465212.6893715053, {  -7.421173136714099e-05, -2.5371153315930584e-05 } },
    {  2465519.918431175, {  -8.491976431379614e-05,    -8.6597873095639e-06 } },
    { 2468331.9642666904, {   5.504587522614737e-05,   2.987052027333017e-05 } },
    {  2468952.742117234, {   8.533333993614671e-05,  1.1960771614118048e-05 } },
    { 2468983.8465660587, {   8.040142657954135e-05,  1.2279835868554435e-05 } },
    { 2469118.4571306757, {   9.099588851554564e-05,   4.397089372772529e-06 } },
    {  2469197.900146639, {    7.77587801513159e-05,  4.6410314955645355e-07 } },
    { 2469634.1349012293, {   8.032174720000127e-05,  -1.950147331205424e-05 } },
    { 2470058.1762880706, {   6.227019063538928e-05, -2.9687071307725826e-05 } },
    {  2470121.712913554, {   4.858705519194829e-05, -3.3608949463871756e-05 } },
    { 2470147.1676779226, {  5.1222216343665474e-05,  -3.632492840210431e-05 } },
    { 2470667.9300145046, {  1.2374763120342644e-05,  -4.416963343244533e-05 } },
    { 2471215.3725827998, {   -3.19349510559835e-05, -4.3099546945105534e-05 } },
    { 2471308.3740479797, { -2.4061406141588675e-05,  -4.090576561609855e-05 } },
    { 2471704.5832334757, {  -5.446803962075565e-05,  -2.981153907934387e-05 } },
    { 2472510.2235084795, {  -8.657790961251794e-05,  -4.771642872913635e-06 } },
    {  2472568.346169985, {   -7.86134773269162e-05, -1.9059526829543797e-06 } },
    {  2472816.569271545, {  -8.329486824328115e-05,   1.164845221599106e-05 } },
    { 2473241.1121675726, {  -7.373249271928142e-05,  2.2755568686112888e-05 } },
    {  2473410.904431842, {  -6.604673213925269e-05,  2.9926700502977643e-05 } },
    {  2473577.920793578, {  -5.679309108063643e-05,   3.604940151994295e-05 } },
    { 2474502.2830641256, {   9.080685419307809e-06,   4.323826957508018e-05 } },
    {  2475411.504451315, {    6.36686028061259e-05,   2.310231066303889e-05 } },
    { 2476010.7029565084, {   8.364522998811612e-05,   -2.70081124588877e-06 } },
    {   2476128.25007599, {    7.89675682938755e-05, -3.5057479949581044e-06 } },
    { 2478880.4162789164, {  -8.275091803689073e-05, -2.0001678604267326e-05 } },
    { 2479058.5208512833, {  -8.688429642559845e-05, -1.3044014614762763e-05 } },
    {  2481078.404376712, {  -9.348567416002988e-06,   4.420148773598907e-05 } },
    {  2447941.815122782, {   6.255677164780874e-05,    3.29367930860867e-05 } },
    { 2448329.1537687215, {   7.784005438264646e-05,   2.227602164065257e-05 } },
    { 2448769.5513091306, {   7.832287683122086e-05,   6.532191376487694e-07 } },
    {  2448782.906417125, {   8.085213600358705e-05,  -6.655228988474188e-07 } },
    { 2450776.5265655154, { -2.6627117834662357e-05,  -4.485100660940602e-05 } },
    {   2451335.35818965, {  -6.105862607319681e-05, -3.4481163124233885e-05 } },
    { 2452064.0605313545, {   -8.68767739711031e-05,  -7.566403411291758e-06 } },
    {  2452529.704062039, {  -7.843304013578646e-05,   1.591081451303812e-05 } },
    {  2454420.421718477, {   3.131604657693224e-05,   3.843562947211819e-05 } },
    { 2455355.9740844844, {    7.69490548294773e-05,   8.335090328687175e-06 } },
    {  2459737.679386839, {  -6.618816030249775e-05,  2.5962812670123683e-05 } },
    { 2460599.9089036025, { -1.3732581653584699e-05,   4.644310512152486e-05 } },
    {  2460626.640128347, { -1.2857541205502313e-05,   4.416115052393834e-05 } },
    { 2462420.1245553177, {   7.821663136384022e-05,  1.7540603299818457e-06 } },
    { 2463722.0632843506, {   2.473113634506205e-05, -4.2339845752428156e-05 } },
    {   2464694.30558652, {  -4.097016685691589e-05, -4.1031738965809016e-05 } },
    { 2464712.3644541884, {  -3.974487482884294e-05,  -3.907022977623702e-05 } },
    {  2465233.465306768, {   -7.30430433041623e-05, -2.4875155237168892e-05 } },
    {  2465559.884566813, {   -8.78851457230609e-05,    -1.0181759893456e-05 } },
    {  2466865.002752615, {  -4.663417286352305e-05,   3.405313202923176e-05 } },
    { 2466874.3763510934, { -4.6619557842386056e-05,   3.408537194941356e-05 } },
    { 2467033.6941557066, {  -3.825655141877159e-05,   3.875580933216822e-05 } },
    {  2467795.600472711, {  2.5127542241056562e-05,   4.029441483061867e-05 } },
    {  2467891.251629429, {  2.6644788086749018e-05,   4.416287140493657e-05 } },
    {  2468512.458462512, {   6.415940188391708e-05,  2.3781697634577404e-05 } },
    { 2468646.4094102522, {   6.439421518245678e-05,   2.364343610907726e-05 } },
    {  2468919.286849884, {   8.505458076977907e-05,  1.1439409899782702e-05 } },
    {  2469347.907736418, {   8.065410165450997e-05, -3.2618399756487863e-06 } },
    { 2471231.4872730295, {   -3.24641080153352e-05,  -4.470673701375204e-05 } },
    {  2471356.817409272, { -3.6016693535939156e-05, -3.8717492249898424e-05 } },
    { 2472311.6164140557, {   -8.87998747313004e-05,   -1.20577809786733e-05 } },
    { 2473411.5667267907, {  -6.614089510872483e-05,  3.0051624471378176e-05 } },
    {  2473557.800894731, { -5.3863065742804046e-05,   3.616142568048677e-05 } },
    {  2475010.015520878, {   4.895466466646109e-05,  3.8377519843253935e-05 } },
    {  2475271.726796562, {   6.266893483867657e-05,  2.5596337844822044e-05 } },
    { 2477725.8364809984, {  1.6333529023243579e-06,  -4.277409396779914e-05 } },
    { 2478684.2521826476, {  -7.089365455620817e-05,  -2.581233703200426e-05 } },
    {    2480022.0241833, {  -6.865274886056792e-05,   2.159858946465826e-05 } },
    {  2480158.938436331, {  -6.763349325971008e-05,  2.8796472851915833e-05 } },
    { 2428999.8887853543, {   6.952526850902241e-05, -2.0369672430819215e-05 } },
    {  2429674.634438809, {   3.899201359748585e-05,  -4.027317160075601e-05 } },
    { 2430196.5329411547, { -2.0503569677458156e-06, -4.6805032851362814e-05 } },
    {  2431261.315008541, {  -7.417645024331675e-05, -2.4572216863711367e-05 } },
    { 2433580.2470611357, { -2.1111941902626786e-06,   4.558922582926093e-05 } },
    {  2433680.707108384, {  1.9646653343079383e-05,    4.29078095320078e-05 } },
    {  2434936.611489937, {    8.35648350614797e-05,   9.005701891861097e-06 } },
    {  2435153.369381389, {   8.881121670837579e-05,   3.535158159374757e-06 } },
    {  2435854.363464088, {   7.593887866064426e-05, -2.6946493683634713e-05 } },
    { 2435980.3498452436, {  5.9800824408160936e-05, -3.0176799518488745e-05 } },
    { 2438126.4215397295, {  -7.816610098784842e-05,  -1.627625605481345e-05 } },
    {  2438720.018574846, {  -9.000682624443383e-05,  3.3048433249138513e-06 } },
    { 2438758.5164731946, {  -8.138604750377351e-05,   3.960174178738974e-06 } },
    { 2439089.6570788035, {  -8.036277472201793e-05,  1.7308851893758018e-05 } },
    { 2440119.8980616047, {  -1.365759508800037e-05,  4.6556987189202826e-05 } },
    { 2440901.5199304377, {   3.482764888170191e-05,  3.8039205142513334e-05 } },
    {   2441157.09958687, {   6.431146115081495e-05,   3.054750855474081e-05 } },
    { 2441215.0681789517, {   6.048678204034146e-05,    3.31193444875168e-05 } },
    {  2442233.665016109, {   8.542837976164011e-05, -1.1579837813348346e-05 } },
    { 2442362.6294974363, {   7.214718870329295e-05,  -1.391222250640604e-05 } },
    {  2443062.365107862, {  4.2405323117517136e-05,  -3.480551811957974e-05 } },
    {  2443196.533941712, {  4.4192150664188156e-05,  -3.800201550050173e-05 } },
    { 2444338.2585685155, {  -4.971762048361172e-05, -3.5561551831932316e-05 } },
    { 2444343.1151478062, {  -5.111388075927601e-05,  -3.499825701576283e-05 } },
    {  2444888.446105143, {   -7.88582817799076e-05, -1.7819222526461704e-05 } },
    { 2445660.5091395047, {   -8.77218333425863e-05,   8.873830130239198e-06 } },
    {  2447121.539144093, {  -6.264287582402476e-06,   4.239021673395021e-05 } },
    {  2447451.840584787, {   2.007354263063331e-05,   4.332177215165069e-05 } },
    { 2448195.1788770445, {    6.23418596374494e-05,  2.5487850139484904e-05 } },
    {  2448878.162741278, {   8.465033496791862e-05,   5.624157443713714e-07 } },
    { 2449562.0447096108, {   7.016810346390836e-05, -2.9198563063494248e-05 } },
    { 2449721.8637289368, {  6.0561442724699496e-05,  -3.583318352096557e-05 } },
    {  2450411.989118112, {  1.0623001460158832e-06, -4.6636692090186056e-05 } },
    { 2450693.3415923356, {  -1.037754743938165e-05, -4.2007891487209404e-05 } },
    {  2451037.967319719, { -3.4784200355030903e-05, -3.8771410210148854e-05 } },
    {  2451395.483637993, {  -5.721499462540186e-05,  -3.058610817863346e-05 } },
    { 2451990.6846387032, {  -8.086364629301367e-05,  -5.500937616352978e-06 } },
    { 2453273.5168695506, {  -4.488940757821363e-05,   3.974169773196589e-05 } },
    {  2453735.099210292, { -1.1086069737828004e-05,   4.038175705991276e-05 } },
    { 2454609.5465663546, {  4.4834714335466475e-05,   3.340658116056451e-05 } },
    { 2461207.3659705357, {   3.606179964654651e-05,   3.634931709678684e-05 } },
    { 2461493.7880732426, {   5.378677566031005e-05,   3.536338551699637e-05 } },
    { 2461503.5452312324, {  5.0692775411101175e-05,  3.5421673373542864e-05 } },
    {  2461985.852816041, {   8.309844533643884e-05,   1.618017849452209e-05 } },
    {  2462775.695383569, {   7.575065209866741e-05, -1.2302860602640519e-05 } },
    { 2463218.7353218948, {   6.194533685120431e-05,  -3.317124092160059e-05 } },
    { 2465660.3346445374, {  -7.898532514471506e-05,  -4.368172273023254e-06 } },
    {  2465722.088212898, {  -8.983628092499182e-05, -1.3149524095970354e-06 } },
    { 2465910.0772395823, {  -8.777227143100868e-05,  4.9804820491786295e-06 } },
    {  2466495.065082976, {  -6.900894737080554e-05,   2.376124070846866e-05 } },
    { 2466516.1435216335, {  -6.465289754530489e-05,  2.5145381041949083e-05 } },
    { 2466822.3165471083, { -5.5239108418422105e-05,   3.610785922206099e-05 } },
    {  2468442.283474225, {    5.88623721332331e-05,  3.1557843346396254e-05 } },
    { 2468583.4566926174, {   7.294523570971246e-05,   2.543215908179783e-05 } },
    {  2470437.415661046, {  3.3932998616318015e-05, -3.7935212767662906e-05 } },
    {  2471370.634653813, { -4.0142943985857584e-05,  -3.925254000144771e-05 } },
    {  2471790.641116046, {  -6.550576689050934e-05, -3.2757448233051504e-05 } },
    {  2472160.567420078, {  -7.996307661708635e-05, -2.0122851476435314e-05 } },
    {  2472728.801397446, {  -7.937972201116064e-05,  3.4985579337898638e-06 } },
    { 2474742.3589693997, {   3.468600528068548e-05,   3.794523698840964e-05 } },
    { 2475119.6755517866, {   6.144863779942255e-05,   3.130815782608694e-05 } },
    {  2475140.030316483, {   6.220690777004925e-05,   3.147158281179089e-05 } },
    {  2475314.596074746, {   7.169453809106424e-05,  2.6131164114491464e-05 } },
    {  2476387.292151793, {    8.34928048519252e-05, -1.7655212208412375e-05 } },
    {  2476441.644377741, {   8.284396286993995e-05, -1.5242373733541641e-05 } },
    { 2476477.7070201347, {   7.319881209446296e-05, -1.6817329572683135e-05 } },
    { 2476786.3404849186, {   7.055961904920433e-05, -2.8627066249361373e-05 } },
    {  2476910.766122023, {   5.478228452430231e-05,  -3.553609773860009e-05 } },
    { 2476970.6446726783, {   5.885786359199076e-05,  -3.488627895536652e-05 } },
  };

  for (const auto& [jde, expected] : dataset) {
    const auto& [lon_nut, obl_nut] = expected;

    ASSERT_NEAR(longitude(jde, Model::IAU_1980).as<RAD>(), lon_nut, 4e-12);
    ASSERT_NEAR(obliquity(jde, Model::IAU_1980).as<RAD>(), obl_nut, 2e-12);
  }
}

} // namespace astro::earth::test
